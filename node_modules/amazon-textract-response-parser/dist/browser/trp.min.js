var trp=function(e){"use strict";class ApiObjectWrapper{constructor(e){this._dict=e}get dict(){return this._dict}}class ApiBlockWrapper extends ApiObjectWrapper{get id(){return this._dict.Id}get blockType(){return this._dict.BlockType}}class DocumentMetadata extends ApiObjectWrapper{get nPages(){var e;return(null===(e=this._dict)||void 0===e?void 0:e.Pages)||0}}function getIterable(e){return{[Symbol.iterator]:()=>{const t=e();let n=0;return{next:()=>n<t.length?{done:!1,value:t[n++]}:{done:!0,value:void 0}}}}}class BoundingBox extends ApiObjectWrapper{constructor(e,t=null){super(e),this._parentGeometry=t}get bottom(){return this.top+this.height}get hCenter(){return this.left+this.width/2}get height(){return this._dict.Height}get left(){return this._dict.Left}get parentGeometry(){return this._parentGeometry}get top(){return this._dict.Top}get right(){return this.left+this.width}get vCenter(){return this.top+this.height/2}get width(){return this._dict.Width}union(e){const t=Math.min(this.left,e.left),n=Math.min(this.top,e.top),s=Math.max(this.right,e.right),i=Math.max(this.bottom,e.bottom);return new BoundingBox({Height:i-n,Left:t,Top:n,Width:s-t},null)}intersection(e){const t=Math.max(this.top,e.top),n=Math.min(this.bottom,e.bottom),s=Math.max(0,n-t),i=Math.max(this.left,e.left),r=Math.min(this.right,e.right),o=Math.max(0,r-i);return s>0&&o>0?new BoundingBox({Height:n-t,Left:i,Top:t,Width:r-i},null):null}str(){return`width: ${this._dict.Width}, height: ${this._dict.Height}, left: ${this._dict.Left}, top: ${this._dict.Top}`}}class Point extends ApiObjectWrapper{constructor(e,t=null){super(e),this._parentGeometry=t}get parentGeometry(){return this._parentGeometry}get x(){return this._dict.X}get y(){return this._dict.Y}str(){return`x: ${this._dict.X}, y: ${this._dict.Y}`}}class Geometry extends ApiObjectWrapper{constructor(e,t){super(e),this._parentObject=t,this._boundingBox=new BoundingBox(e.BoundingBox,this),this._polygon=e.Polygon.map((e=>new Point(e,this)))}get boundingBox(){return this._boundingBox}get parentObject(){return this._parentObject}get polygon(){return this._polygon.slice()}orientationRadians(){if(!this._polygon||this._polygon.length<2)return null;const e=this._polygon[0],t=this._polygon[1];return Math.atan2(t.y-e.y,t.x-e.x)}orientationDegrees(){const e=this.orientationRadians();return null==e?e:180*e/Math.PI}str(){return`BoundingBox: ${this._boundingBox.str()}`}}class Word extends ApiBlockWrapper{constructor(e){super(e),this._geometry=new Geometry(e.Geometry,this)}get confidence(){return this._dict.Confidence}set confidence(e){this._dict.Confidence=e}get geometry(){return this._geometry}get text(){return this._dict.Text}get textType(){return this._dict.TextType}set textType(e){this._dict.TextType=e}str(){return this.text}}function WithWords(e){return class extends e{constructor(...e){super(...e),this._words=[]}get nWords(){return this._words.length}iterWords(){return getIterable((()=>this._words))}listWords(){return this._words.slice()}wordAtIndex(e){if(e<0||e>=this._words.length)throw new Error(`Word index ${e} must be >=0 and <${this._words.length}`);return this._words[e]}}}class LineGeneric extends(WithWords(ApiBlockWrapper)){constructor(e,t){super(e),this._parentPage=t,this._words=[],this._geometry=new Geometry(e.Geometry,this);const n=t.parentDocument;e.Relationships&&e.Relationships.forEach((e=>{"CHILD"==e.Type&&e.Ids.forEach((e=>{const t=n.getBlockById(e);t?"WORD"==t.BlockType&&this._words.push(new Word(t)):console.warn(`Document missing word block ${e} referenced by line ${this.id}`)}))}))}get confidence(){return this._dict.Confidence}set confidence(e){this._dict.Confidence=e}get geometry(){return this._geometry}get parentPage(){return this._parentPage}get text(){return this._dict.Text}str(){return`Line\n==========\n${this._dict.Text}\nWords\n----------\n${this._words.map((e=>`[${e.str()}]`)).join("")}`}}class SelectionElement extends ApiBlockWrapper{constructor(e){super(e),this._geometry=new Geometry(e.Geometry,this)}get confidence(){return this._dict.Confidence}set confidence(e){this._dict.Confidence=e}get geometry(){return this._geometry}get selectionStatus(){return this._dict.SelectionStatus}set selectionStatus(e){this._dict.SelectionStatus=e}}class FieldKeyGeneric extends(WithWords(ApiBlockWrapper)){constructor(e,t){super(e),this._parentField=t,this._words=[],this._geometry=new Geometry(e.Geometry,this);let n=[];(e.Relationships||[]).forEach((e=>{"CHILD"==e.Type&&(n=n.concat(e.Ids))}));const s=t.parentForm.parentPage.parentDocument;n.map((e=>{const t=s.getBlockById(e);return t||console.warn(`Document missing child block ${e} referenced by field key ${this.id}`),t})).forEach((e=>{e&&"WORD"==e.BlockType&&this._words.push(new Word(e))}))}get confidence(){return this._dict.Confidence}get geometry(){return this._geometry}get parentField(){return this._parentField}get text(){return this._words.map((e=>e.text)).join(" ")}str(){return this.text}}class FieldValueGeneric extends ApiBlockWrapper{constructor(e,t){super(e),this._content=[],this._parentField=t,this._geometry=new Geometry(e.Geometry,this);let n=[];(e.Relationships||[]).forEach((e=>{"CHILD"==e.Type&&(n=n.concat(e.Ids))}));const s=t.parentForm.parentPage.parentDocument;n.map((e=>{const t=s.getBlockById(e);return t||console.warn(`Document missing child block ${e} referenced by field value ${this.id}`),t})).forEach((e=>{e&&("WORD"==e.BlockType?this._content.push(new Word(e)):"SELECTION_ELEMENT"==e.BlockType&&this._content.push(new SelectionElement(e)))}))}get confidence(){return this._dict.Confidence}get geometry(){return this._geometry}get parentField(){return this._parentField}get text(){return this._content.map((e=>"selectionStatus"in e?e.selectionStatus:e.text)).join(" ")}listContent(){return this._content.slice()}str(){return this.text}}class FieldGeneric{constructor(e,t){this._parentForm=t,this._value=null,this._key=new FieldKeyGeneric(e,this);let n=[];if((e.Relationships||[]).forEach((e=>{"VALUE"==e.Type&&(n=n.concat(e.Ids))})),n.length>1){const e=this._key?`field '${this._key.text}'`:"unnamed form field";console.warn(`Got ${n.length} value blocks for ${e} (Expected 0-1). Including first only.`)}if(n.length){const e=t.parentPage.parentDocument,s=n[0],i=e.getBlockById(s);i?this._value=new FieldValueGeneric(i,this):console.warn(`Document missing child block ${s} referenced by value for field key ${this.key.id}`)}}get confidence(){const e=[];return this._key&&e.push(this._key.confidence||0),this._value&&e.push(this._value.confidence||0),e.length?e.reduce(((e,t)=>e+t),0)/e.length:0}get key(){return this._key}get parentForm(){return this._parentForm}get parentPage(){return this._parentForm.parentPage}get value(){return this._value}str(){return`\nField\n==========\nKey: ${this._key?this._key.str():""}\nValue: ${this._value?this._value.str():""}`}}class FormGeneric{constructor(e,t){this._fields=[],this._fieldsMap={},this._parentPage=t,e.forEach((e=>{const t=new FieldGeneric(e,this);this._fields.push(t);const n=t.key.text||"";n&&(n in this._fieldsMap?t.confidence>this._fieldsMap[n].confidence&&(this._fieldsMap[n]=t):this._fieldsMap[n]=t)}))}get nFields(){return this._fields.length}get parentPage(){return this._parentPage}getFieldByKey(e){return this._fieldsMap[e]||null}iterFields(e=!1){return getIterable((()=>this.listFields(e)))}listFields(e=!1){return e?this._fields.filter((e=>e.key)):this._fields.slice()}searchFieldsByKey(e){const t=e.toLowerCase();return this._fields.filter((e=>e.key&&e.key.text.toLowerCase().indexOf(t)>=0))}str(){return this._fields.map((e=>e.str())).join("\n")}}class FormsCompositeGeneric{constructor(e,t){this._forms=e,this._parentDocument=t}get nFields(){return this._forms.reduce(((e,t)=>e+t.nFields),0)}get parentDocument(){return this._parentDocument}getFieldByKey(e){for(const t of this._forms){const n=t.getFieldByKey(e);if(n)return n}return null}iterFields(e=!1){return getIterable((()=>this.listFields(e)))}listFields(e=!1){const t=[].concat(...this._forms.map((e=>e.listFields())));return e?t.filter((e=>e.key)):t}searchFieldsByKey(e){return[].concat(...this._forms.map((t=>t.searchFieldsByKey(e))))}str(){return this._forms.map((e=>e.str())).join("\n")}}class CellBaseGeneric extends ApiBlockWrapper{constructor(e,t){super(e),this._geometry=new Geometry(e.Geometry,this),this._parentTable=t}get columnIndex(){return this._dict.ColumnIndex}get columnSpan(){return this._dict.ColumnSpan||1}get confidence(){return this._dict.Confidence}set confidence(e){this._dict.Confidence=e}get geometry(){return this._geometry}get parentTable(){return this._parentTable}get rowIndex(){return this._dict.RowIndex}get rowSpan(){return this._dict.RowSpan||1}}class CellGeneric extends CellBaseGeneric{constructor(e,t){super(e,t);const n=t.parentPage.parentDocument;this._geometry=new Geometry(e.Geometry,this),this._content=[];const s=[];(e.Relationships||[]).forEach((e=>{"CHILD"==e.Type&&e.Ids.forEach((e=>{const t=n.getBlockById(e);if(!t)return void console.warn(`Document missing child block ${e} referenced by table cell ${this.id}`);const i=t.BlockType;if("WORD"==i){const e=new Word(t);this._content.push(e),s.push(e.text)}else if("SELECTION_ELEMENT"==i){const e=new SelectionElement(t);this._content.push(e),s.push(e.selectionStatus+",")}}))})),this._text=s.join(" ")}get text(){return this._text}listContent(){return this._content.slice()}str(){return this._text}}class MergedCellGeneric extends CellBaseGeneric{constructor(e,t){super(e,t);let n=[];(e.Relationships||[]).forEach((e=>{"CHILD"==e.Type&&(n=n.concat(e.Ids.map((e=>t._getSplitCellByBlockId(e)))))})),this._cells=n}get text(){return this._cells.map((e=>e.text)).join(" ")}listContent(){return[].concat(...this._cells.map((e=>e.listContent())))}str(){return this.text}}class RowGeneric{constructor(e=[],t){this._cells=e,this._parentTable=t}get nCells(){return this._cells.length}get parentTable(){return this._parentTable}iterCells(){return getIterable((()=>this._cells))}listCells(){return this._cells.slice()}str(){return this._cells.map((e=>`[${e.str()}]`)).join("")}}class TableGeneric extends ApiBlockWrapper{constructor(e,t){super(e),this._parentPage=t,this._geometry=new Geometry(e.Geometry,this);const n=t.parentDocument;this._cells=[].concat(...(e.Relationships||[]).filter((e=>"CHILD"==e.Type)).map((e=>e.Ids.map((e=>{const t=n.getBlockById(e);if(t)return new CellGeneric(t,this);console.warn(`Document missing child block ${e} referenced by TABLE ${this.id}`)})).filter((e=>e))))),this._sortCellsByLocation(this._cells),this._nCols=this._cells.reduce(((e,t)=>Math.max(e,t.columnIndex+t.columnSpan-1)),0),this._nRows=this._cells.reduce(((e,t)=>Math.max(e,t.rowIndex+t.rowSpan-1)),0),this._cellsById={},this._updateCellsById(),this._mergedCells=[].concat(...(e.Relationships||[]).filter((e=>"MERGED_CELL"==e.Type)).map((e=>e.Ids.map((e=>{const t=n.getBlockById(e);if(t)return new MergedCellGeneric(t,this);console.warn(`Document missing merged cell block ${e} referenced by TABLE ${this.id}`)})).filter((e=>e)))))}_sortCellsByLocation(e){e.sort(((e,t)=>e.rowIndex-t.rowIndex||e.columnIndex-t.columnIndex))}_updateCellsById(){this._cellsById=this._cells.reduce(((e,t)=>(e[t.id]=t,e)),{})}_getSplitCellByBlockId(e){let t=this._cellsById[e];if(t)return t;if(this._updateCellsById(),t=this._cellsById[e],!t)throw new Error(`Referenced cell ID ${e} missing from TABLE ${this.id}`);return t}cellAt(e,t,n=!1){const s=!n&&this._mergedCells.find((n=>n.columnIndex<=t&&n.columnIndex+n.columnSpan>t&&n.rowIndex<=e&&n.rowIndex+n.rowSpan>e));return s||this._cells.find((n=>n.columnIndex===t&&n.rowIndex===e))}cellsAt(e,t,n=!1){const s=n?[]:this._mergedCells.filter((n=>(null==e||n.rowIndex<=e&&n.rowIndex+n.rowSpan>e)&&(null==t||n.columnIndex<=t&&n.columnIndex+n.columnSpan>t))),i=s.reduce(((e,t)=>(t._cells.forEach((t=>{e[t.id]=!0})),e)),{}),r=this._cells.filter((n=>!(null!=e&&n.rowIndex!==e||null!=t&&n.columnIndex!==t||n.id in i))),o=s.concat(r);return this._sortCellsByLocation(o),o}iterRows(e=!1){return{[Symbol.iterator]:()=>{let t=0;return{next:()=>t<this._nRows?{done:!1,value:this.rowAt(++t,e)}:{done:!0,value:void 0}}}}}listRows(e=!1){return[...Array(this._nRows).keys()].map((t=>this.rowAt(t+1,e)))}rowAt(e,t=!1){const n=this.cellsAt(e,null);return new RowGeneric(t?n:n.filter((t=>t.rowIndex===e)),this)}get confidence(){return this._dict.Confidence}set confidence(e){this._dict.Confidence=e}get geometry(){return this._geometry}get nCells(){return this._cells.length}get nColumns(){return this._nCols}get nRows(){return this._nRows}get parentPage(){return this._parentPage}str(){return"Table\n==========\n"+this.listRows().map((e=>`Row\n==========\n${e.str()}`)).join("\n")}}class Page extends ApiBlockWrapper{constructor(e,t,n){super(e),this._blocks=t,this._parentDocument=n,this._geometry=new Geometry(e.Geometry,this),this._content=[],this._lines=[],this._tables=[],this._form=new FormGeneric([],this),this._parse(t)}_parse(e){this._content=[],this._lines=[],this._tables=[];const t=[];e.forEach((e=>{if("LINE"==e.BlockType){const t=new LineGeneric(e,this);this._lines.push(t),this._content.push(t)}else if("TABLE"==e.BlockType){const t=new TableGeneric(e,this);this._tables.push(t),this._content.push(t)}else"KEY_VALUE_SET"==e.BlockType&&e.EntityTypes.indexOf("KEY")>=0&&t.push(e)})),this._form=new FormGeneric(t,this)}getModalWordOrientationDegrees(){const e=this.listLines().map((e=>e.listWords().map((e=>e.geometry.orientationDegrees()))));return function modalAvg(e){const t={};for(const n of e)t[n]?++t[n].freq:t[n]={value:n,freq:1};let n=0,s=null;for(const e in t)t[e].freq>n&&(n=t[e].freq,s=t[e].value);return s}([].concat(...e).filter((e=>null!=e)).map((e=>Math.round(e))))}_getLineClustersByColumn({colHOverlapThresh:e=.8,colHMultilineUnionThresh:t=.7,paraVDistTol:n=.7,paraLineHeightTol:s=.3,paraIndentThresh:i=0}={}){const r=[],o=[],l=[],c=this._lines.map((e=>e.geometry.boundingBox.hCenter));this._lines.forEach(((e,t)=>{const a=e.geometry.boundingBox,h=c[t];let d,u;/[^.,_\s]/.test(e.text)?/[^-–—=~\s]/.test(e.text)?/[^'"`^\s]/.test(e.text)?/[^-–—=~.,_acemnorsuvwxz+<>:;\s]/.test(e.text)?(d=!1,u=a):(d=!1,u=new BoundingBox({Top:a.top-.25*a.height,Left:a.left,Height:1.25*a.height,Width:a.width},null)):(d=!0,u=new BoundingBox({Top:a.top,Left:a.left,Height:2.5*a.height,Width:a.width},null)):(d=!0,u=new BoundingBox({Top:a.top-.75*a.height,Left:a.left,Height:2.5*a.height,Width:a.width},null)):(d=!0,u=new BoundingBox({Top:a.top-1.5*a.height,Left:a.left,Height:2.5*a.height,Width:a.width},null));let p=null;for(let t=0;t<r.length;++t){const c=r[t],g=c.hCenter,m=o[t].length;let _,y;d?(y=l[t]/m,_=y*(m+1)):(_=l[t]+u.height,y=_/(m+1));const x=Math.max(0,u.top-c.bottom,c.top-u.bottom);let f;if(i){const e=o[t][m-1].geometry.boundingBox.left-(1===m?i*y:0),n=Math.max(u.top,c.top),s=Math.min(u.bottom,c.bottom),r=Math.max(0,s-n);f=Math.max(0,u.left-e)<i*y||r>.5*u.height}else f=!0;if((h>c.left&&h<c.right||g>a.left&&g<a.right)&&x<y*n&&(d||Math.abs((y-u.height)/y)<s)&&f){p=t,r[t]=c.union(a),o[t].push(e),l[t]=_;break}}null==p&&(r.push(new BoundingBox(a.dict)),o.push([e]),l.push(a.height))}));const a=[],h=[];return o.forEach(((n,s)=>{const i=r[s];let c=null;for(let r=0;r<a.length;++r){const d=a[r],u=h[r],p=Math.max(d.top,i.top),g=Math.min(d.bottom,i.bottom),m=Math.max(0,g-p),_=Math.max(d.left,i.left),y=Math.min(d.right,i.right),x=Math.max(0,y-_),f=Math.max(d.right,i.right)-Math.min(d.left,i.left),T=Math.min(d.width,i.width),I=d.union(i),w=1===n.length||1===u.length&&1===u[0].length;if(m<.1*(l[s]/o[s].length)&&x/T>=e&&(w||x/f>=t)&&x/T>=e&&1===a.filter((e=>e.intersection(I))).length){c=r,a[r]=d.union(i),h[r].push(n);break}}null==c&&(a.push(new BoundingBox(i.dict)),h.push([n]))})),h}getLineClustersInReadingOrder({colHOverlapThresh:e=.8,colHMultilineUnionThresh:t=.7,paraVDistTol:n=.7,paraLineHeightTol:s=.3,paraIndentThresh:i=0}={}){return[].concat(...this._getLineClustersByColumn({colHOverlapThresh:e,colHMultilineUnionThresh:t,paraVDistTol:n,paraLineHeightTol:s,paraIndentThresh:i}))}getTextInReadingOrder({colHOverlapThresh:e=.8,colHMultilineUnionThresh:t=.7,paraVDistTol:n=.7,paraLineHeightTol:s=.3,paraIndentThresh:i=0}={}){return this.getLineClustersInReadingOrder({colHOverlapThresh:e,colHMultilineUnionThresh:t,paraVDistTol:n,paraLineHeightTol:s,paraIndentThresh:i}).map((e=>e.map((e=>e.text)).join("\n"))).join("\n\n")}_groupLinesByVerticalGaps(e,t,n){let s=[new BoundingBox({Top:e,Left:this._geometry.boundingBox.left,Height:t,Width:this._geometry.boundingBox.width},null)],i=[[]],r=[];return(n||this._lines).forEach((e=>{const t=e.geometry.boundingBox;if(t.top>s[s.length-1].bottom)return void r.push(e);if(t.bottom<s[0].top)return void i[0].push(e);const n=[],o=[];let l=[],c=!1;for(let r=0;r<s.length;++r){const a=s[r],h=i[r],d=t.intersection(a);if(d)if(d.top!==a.top||d.height!==a.height)if(d.top>a.top&&d.bottom<a.bottom)n.push(new BoundingBox({Top:a.top,Left:a.left,Height:d.top-a.top,Width:a.width},null)),o.push(l.concat(h)),l=[],n.push(new BoundingBox({Top:d.bottom,Left:a.left,Height:a.bottom-d.bottom,Width:a.width},null)),o.push([e]),c=!0;else{const t=l.concat(h);d.top===a.top?(t.push(e),c=!0,n.push(new BoundingBox({Top:a.top+d.height,Left:a.left,Height:a.height-d.height,Width:a.width},null))):n.push(new BoundingBox({Top:a.top,Left:a.left,Height:d.top-a.top,Width:a.width},null)),o.push(t),l=[]}else l=l.concat(h);else n.push(a),o.push(l.concat(h)),l=[]}if(s=n,i=o,r=l.concat(r),!c){const n=s.findIndex((e=>e.top>=t.bottom));n<0?r.push(e):i[n].push(e)}})),{vGaps:s,lines:i.concat([r])}}_getHeaderOrFooterLines(e,{maxMargin:t=.16,minGap:n=.8}={},s){const{vGaps:i,lines:r}=this._groupLinesByVerticalGaps(e?this._geometry.boundingBox.top:this._geometry.boundingBox.bottom-t,t,s),o=r.map((e=>e.length?e.reduce(((e,t)=>e+t.geometry.boundingBox.height),0)/e.length:null)),l=o.filter((e=>e)),c=l.reduce(((e,t)=>e+t),0)/l.length,a=i.map(((e,t)=>{const n=[],s=o[t];s&&n.push(s);const i=o[t+1];return i&&n.push(i),n.length?n.reduce(((e,t)=>e+t),0)/n.length:c}));if(e){const e=i.findIndex(((e,t)=>(t>0||r[t].length)&&e.height>=a[t]*n));return e<0?[]:[].concat(...r.slice(0,e+1))}{const e=r.slice().reverse(),t=a.slice().reverse(),s=i.slice().reverse().findIndex(((s,i)=>(i>0||e[i].length)&&s.height>=t[i]*n));return s<0?[]:[].concat(...r.slice(i.length-s))}}getFooterLines(e={},t){return this._getHeaderOrFooterLines(!1,e,t)}getHeaderLines(e={},t){return this._getHeaderOrFooterLines(!0,e,t)}getLinesByLayoutArea(e=!1,t={},n={}){const s=e?[].concat(...!0===e?this.getLineClustersInReadingOrder():this.getLineClustersInReadingOrder(e)):this._lines,i=s.reduce(((e,t,n)=>(e[t.id]=n,e)),{}),r=this._getHeaderOrFooterLines(!0,t,s).sort(((e,t)=>i[e.id]-i[t.id]));let o=r.reduce(((e,t)=>(e[t.id]=!0,e)),{});const l=this._getHeaderOrFooterLines(!1,n,s.filter((e=>!(e.id in o)))).sort(((e,t)=>i[e.id]-i[t.id]));return o=l.reduce(((e,t)=>(e[t.id]=!0,e)),o),{header:r,content:s.filter((e=>!(e.id in o))).sort(((e,t)=>i[e.id]-i[t.id])),footer:l}}iterLines(){return getIterable((()=>this._lines))}iterTables(){return getIterable((()=>this._tables))}lineAtIndex(e){if(e<0||e>=this._lines.length)throw new Error(`Line index ${e} must be >=0 and <${this._lines.length}`);return this._lines[e]}listBlocks(){return this._blocks.slice()}listLines(){return this._lines.slice()}listTables(){return this._tables.slice()}tableAtIndex(e){if(e<0||e>=this._tables.length)throw new Error(`Table index ${e} must be >=0 and <${this._tables.length}`);return this._tables[e]}get form(){return this._form}get geometry(){return this._geometry}get nLines(){return this._lines.length}get nTables(){return this._tables.length}get pageNumber(){const e=this._parentDocument._pages.indexOf(this);if(e<0)throw new Error("parentDocument does not seem to contain this Page");return e+1}get parentDocument(){return this._parentDocument}get text(){return this._lines.map((e=>e.text)).join("\n")}str(){return`Page\n==========\n${this._content.join("\n")}\n`}}class TextractDocument extends ApiObjectWrapper{constructor(e){var t;let n;if(Array.isArray(e))n=TextractDocument._consolidateMultipleResponses(e);else{if(!("Blocks"in e)||!(null===(t=e.Blocks)||void 0===t?void 0:t.length))throw new Error("Provided Textract JSON has no content! (.Blocks array)");n=e}super(n),"NextToken"in this._dict&&console.warn("Provided Textract JSON contains a NextToken: Content may be truncated!"),this._blockMap={},this._pages=[],this._form=new FormsCompositeGeneric([],this),this._parse()}_parse(){this._blockMap=this._dict.Blocks.reduce(((e,t)=>(e[t.Id]=t,e)),{});let e=null,t=[];this._pages=[],this._dict.Blocks.forEach((n=>{"PAGE"==n.BlockType?(e&&this._pages.push(new Page(e,t,this)),e=n,t=[n]):t.push(n)})),e&&this._pages.push(new Page(e,t,this)),this._form=new FormsCompositeGeneric(this._pages.map((e=>e.form)),this)}static _consolidateMultipleResponses(e){if(!(null==e?void 0:e.length))throw new Error("Input Textract Results list empty!");let t=0;const n={Pages:0};let s=[],i="",r=null,o=null,l=null,c=null;for(const a of e){if("Blocks"in a&&a.Blocks?s=s.concat(a.Blocks):console.warn("Found Textract response with no content"),"DocumentMetadata"in a&&(Object.assign(n,a.DocumentMetadata),t=Math.max(t,a.DocumentMetadata.Pages)),"AnalyzeDocumentModelVersion"in a){if(r&&"AnalyzeDocument"!==r)throw new Error("Inconsistent textractResults contain both AnalyzeDocument and DetectText results");r="AnalyzeDocument",i&&i!==a.AnalyzeDocumentModelVersion?console.warn(`Inconsistent Textract model versions ${i} and ${a.AnalyzeDocumentModelVersion}: Ignoring latter`):i=a.AnalyzeDocumentModelVersion}if("DetectDocumentTextModelVersion"in a){if(r&&"DetectText"!==r)throw new Error("Inconsistent textractResults contain both AnalyzeDocument and DetectText results");r="DetectText",i&&i!==a.DetectDocumentTextModelVersion?console.warn(`Inconsistent Textract model versions ${i} and ${a.DetectDocumentTextModelVersion}: Ignoring latter`):i=a.DetectDocumentTextModelVersion}if("JobStatus"in a){if("FAILED"==a.JobStatus||(a.JobStatus||"").toLocaleUpperCase().indexOf("FAIL")>=0)throw new Error(`Textract results contain failed job of status ${a.JobStatus}`);if(o&&o!==a.JobStatus)throw new Error(`Textract results inconsistent JobStatus values ${o}, ${a.JobStatus}`);o=a.JobStatus}"StatusMessage"in a&&a.StatusMessage&&(l&&a.StatusMessage!==l?(console.warn("Multiple StatusMessages in Textract results - keeping longest"),a.StatusMessage.length>l.length&&(l=a.StatusMessage)):l=a.StatusMessage),"Warnings"in a&&a.Warnings&&(c=c?c.concat(a.Warnings):a.Warnings)}const a={DocumentMetadata:n,Blocks:s},h="AnalyzeDocument"==r?{AnalyzeDocumentModelVersion:i}:"DetectText"==r?{DetectDocumentTextModelVersion:i}:{AnalyzeDocumentModelVersion:i||"Unknown"},d=o?{JobStatus:o}:{},u=l?{StatusMessage:l}:{},p=c?{ArfBarf:c}:{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},a),h),d),u),p)}get form(){return this._form}get nPages(){return this._pages.length}getBlockById(e){return this._blockMap&&this._blockMap[e]}iterPages(){return getIterable((()=>this._pages))}listBlocks(){return this._dict.Blocks.slice()}listPages(){return this._pages.slice()}pageNumber(e){if(!(e>=1&&e<=this._pages.length))throw new Error(`pageNum ${e} must be between 1 and ${this._pages.length}`);return this._pages[e-1]}str(){return`\nDocument\n==========\n${this._pages.map((e=>e.str())).join("\n\n")}\n\n`}}class ExpenseComponentDetection extends ApiObjectWrapper{constructor(e,t){super(e),this._parentField=t,this._geometry=e.Geometry?new Geometry(e.Geometry,this):void 0}get confidence(){return this._dict.Confidence}set confidence(e){this._dict.Confidence=e}get geometry(){return this._geometry}get parentField(){return this._parentField}get text(){return this._dict.Text}set text(e){this._dict.Text=e}}class ExpenseFieldType extends ApiObjectWrapper{constructor(e,t){super(e),this._parentField=t}get confidence(){return this._dict.Confidence}set confidence(e){this._dict.Confidence=e}get parentField(){return this._parentField}get text(){return this._dict.Text}set text(e){this._dict.Text=e}}class ExpenseField extends ApiObjectWrapper{constructor(e,t){super(e),this._parent=t,this._fieldType=new ExpenseFieldType(e.Type,this),this._label=e.LabelDetection?new ExpenseComponentDetection(e.LabelDetection,this):null,this._value=new ExpenseComponentDetection(e.ValueDetection,this)}get fieldType(){return this._fieldType}get label(){return this._label}get pageNumber(){return this._dict.PageNumber}get parent(){return this._parent}get value(){return this._value}}class ExpenseLineItem extends ApiObjectWrapper{constructor(e,t){super(e),this._parentGroup=t,this._fields=(e.LineItemExpenseFields||[]).map((e=>new ExpenseField(e,this)))}get nFields(){return this._fields.length}get parentGroup(){return this._parentGroup}iterFields(){return getIterable((()=>this._fields))}listFields(){return this._fields.slice()}getFieldByType(e){const t=this.searchFieldsByType(e);return t.length?t[0]:null}searchFieldsByType(e){return this._fields.filter((t=>t.fieldType.text==e))}}class ExpenseLineItemGroup extends ApiObjectWrapper{constructor(e,t){super(e),this._parentDoc=t,this._lineItems=(e.LineItems||[]).map((e=>new ExpenseLineItem(e,this)))}get index(){return this._dict.LineItemGroupIndex}get nLineItems(){return this._lineItems.length}get parentDoc(){return this._parentDoc}iterLineItems(){return getIterable((()=>this._lineItems))}listLineItems(){return this._lineItems.slice()}}class ExpenseDocument extends ApiObjectWrapper{constructor(e,t=null){super(e),this._parentExpense=t,this._lineItemGroups=(e.LineItemGroups||[]).map((e=>new ExpenseLineItemGroup(e,this))),this._summaryFields=(e.SummaryFields||[]).map((e=>new ExpenseField(e,this)))}get index(){return this._dict.ExpenseIndex}get nLineItemGroups(){return this._lineItemGroups.length}get nSummaryFields(){return this._summaryFields.length}get parentExpense(){return this._parentExpense}getSummaryFieldByType(e){const t=this.searchSummaryFieldsByType(e);return t.length?t[0]:null}searchSummaryFieldsByType(e){return this._summaryFields.filter((t=>t.fieldType.text==e))}iterLineItemGroups(){return getIterable((()=>this._lineItemGroups))}iterSummaryFields(){return getIterable((()=>this._summaryFields))}listLineItemGroups(){return this._lineItemGroups.slice()}listSummaryFields(){return this._summaryFields.slice()}}var t,n,s;e.IdFieldType=void 0,(t=e.IdFieldType||(e.IdFieldType={})).FirstName="FIRST_NAME",t.LastName="LAST_NAME",t.MiddleName="MIDDLE_NAME",t.Suffix="SUFFIX",t.AddressCity="CITY_IN_ADDRESS",t.AddressZipCode="ZIP_CODE_IN_ADDRESS",t.AddressState="STATE_IN_ADDRESS",t.StateName="STATE_NAME",t.DocumentNumber="DOCUMENT_NUMBER",t.ExpirationDate="EXPIRATION_DATE",t.DateOfBirth="DATE_OF_BIRTH",t.DateOfIssue="DATE_OF_ISSUE",t.IdType="ID_TYPE",t.Endorsements="ENDORSEMENTS",t.Veteran="VETERAN",t.Restrictions="RESTRICTIONS",t.Class="CLASS",t.Address="ADDRESS",t.County="COUNTY",t.PlaceOfBirth="PLACE_OF_BIRTH",t.Other="OTHER",e.IdFieldValueType=void 0,(n=e.IdFieldValueType||(e.IdFieldValueType={})).Date="DATE",n.Other="OTHER",e.IdDocumentType=void 0,(s=e.IdDocumentType||(e.IdDocumentType={})).DrivingLicense="DRIVER LICENSE FRONT",s.Passport="PASSPORT",s.Other="OTHER";class IdDocumentField extends ApiObjectWrapper{constructor(e,t=void 0){super(e),this._parentDocument=t}get isValueNormalized(){var e,t;return void 0!==(null===(t=null===(e=this._dict.ValueDetection)||void 0===e?void 0:e.NormalizedValue)||void 0===t?void 0:t.Value)}get fieldTypeRaw(){var e;return null===(e=this._dict.Type)||void 0===e?void 0:e.Text}get fieldType(){var t;const n=this._dict.Type,s=((null===(t=null==n?void 0:n.NormalizedValue)||void 0===t?void 0:t.Value)||(null==n?void 0:n.Text)||"").toUpperCase();return Object.values(e.IdFieldType).some((e=>e===s))?s:e.IdFieldType.Other}get parentDocument(){return this._parentDocument}get value(){var e;const t=this._dict.ValueDetection;return(null===(e=null==t?void 0:t.NormalizedValue)||void 0===e?void 0:e.Value)||(null==t?void 0:t.Text)||""}get valueConfidence(){var e;return(null===(e=this._dict.ValueDetection)||void 0===e?void 0:e.Confidence)||0}get valueRaw(){var e;return null===(e=this._dict.ValueDetection)||void 0===e?void 0:e.Text}get valueType(){var e,t;let n=null===(t=null===(e=this._dict.ValueDetection)||void 0===e?void 0:e.NormalizedValue)||void 0===t?void 0:t.ValueType;return n&&(n=n.toUpperCase()),"DATE"===n?"DATE":"OTHER"}str(){return`${this.fieldType}: ${this.value} (${this.valueConfidence.toFixed(1)}% Confidence)`}}class IdDocument extends ApiObjectWrapper{constructor(e,t=void 0){super(e),this._parentResult=t,this._fields=(e.IdentityDocumentFields||[]).map((e=>new IdDocumentField(e,this))),this._fieldsByNormalizedType={},this._fields.forEach((e=>{this._fieldsByNormalizedType[e.fieldType]=e}))}get index(){return this._dict.DocumentIndex}get idType(){var t;const n=null===(t=this.getFieldByType(e.IdFieldType.IdType))||void 0===t?void 0:t.value;return Object.values(e.IdDocumentType).some((e=>e===n))?n:e.IdDocumentType.Other}get nFields(){return this._fields.length}get parentCollection(){return this._parentResult}getFieldByType(e){return this._fieldsByNormalizedType[e]}iterFields(){return getIterable((()=>this.listFields()))}listFields(){return this._fields.slice()}str(){const e=this._fields.map((e=>e.str())).join("\n");return`==========\nIdentity Document ${this.index} (${this.idType})\n----------\n${e}\n==========`}}return e.ApiBlockWrapper=ApiBlockWrapper,e.Cell=class Cell extends CellGeneric{},e.CellBase=class CellBase extends CellBaseGeneric{},e.ExpenseComponentDetection=ExpenseComponentDetection,e.ExpenseDocument=ExpenseDocument,e.ExpenseField=ExpenseField,e.ExpenseFieldType=ExpenseFieldType,e.ExpenseLineItem=ExpenseLineItem,e.ExpenseLineItemGroup=ExpenseLineItemGroup,e.Field=class Field extends FieldGeneric{},e.FieldKey=class FieldKey extends FieldKeyGeneric{},e.FieldValue=class FieldValue extends FieldValueGeneric{},e.Form=class Form extends FormGeneric{},e.FormsComposite=class FormsComposite extends FormsCompositeGeneric{},e.IdDocument=IdDocument,e.IdDocumentField=IdDocumentField,e.Line=class Line extends LineGeneric{},e.MergedCell=class MergedCell extends MergedCellGeneric{},e.Page=Page,e.Row=class Row extends RowGeneric{},e.SelectionElement=SelectionElement,e.Table=class Table extends TableGeneric{},e.TextractDocument=TextractDocument,e.TextractExpense=class TextractExpense extends ApiObjectWrapper{constructor(e){if(super(e),!e.ExpenseDocuments)throw new Error("Input doesn't seem like a Textract expense analysis result: missing property 'ExpenseDocuments'");this._metadata=new DocumentMetadata(e.DocumentMetadata),this._docs=(e.ExpenseDocuments||[]).map((e=>new ExpenseDocument(e,this)))}get metadata(){return this._metadata}get nDocs(){return this._docs.length}iterDocs(){return getIterable((()=>this._docs))}listDocs(){return this._docs.slice()}},e.TextractIdentity=class TextractIdentity extends ApiObjectWrapper{constructor(e){super(e),this._documents=(e.IdentityDocuments||[]).map((e=>new IdDocument(e,this)))}get modelVersion(){return this._dict.AnalyzeIDModelVersion}get nDocuments(){return this._documents.length}get nPages(){var e;return(null===(e=this._dict.DocumentMetadata)||void 0===e?void 0:e.Pages)||0}getDocAtIndex(e){if(!(e>=0&&e<this._documents.length))throw new Error(`Document index ${e} must be between 0 and ${this._documents.length}`);return this._documents[e]}iterDocuments(){return getIterable((()=>this.listDocuments()))}listDocuments(){return this._documents.slice()}str(){return this._documents.map((e=>e.str())).join("\n\n")}},e.Word=Word,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=trp.min.js.map
